{% assign image = page.header | default: site.header %}
{% assign dark = page.header-dark | is_nil: site.header-dark | is_nil: true %}

{% assign svg = "images/logo.svg" | file_exists %}
{% assign png = "images/logo.png" | file_exists %}
{% assign jpg = "images/logo.jpg" | file_exists %}
{% assign logo = svg | default: png | default: jpg | default: nil %}

<header
  class="header-wrapper"
  {% if dark == true or dark == false %}
    data-dark="{{ dark }}"
  {% endif %}
  {% if page.url == "/" %}
    data-big
  {% endif %}
>
  <!-- Tier 1: 品牌和全局工具栏 -->
  <div class="header-tier-1">
    <div class="header-container">
      <!-- 左侧：Logo 和网站标题 -->
      <div class="brand-section">
        <a href="{{ "/" | relative_url }}" class="home">
          {% if logo %}
            <span class="logo">
              {% if svg %}
                {{ svg | file_read }}
              {% else %}
                <img src="{{ logo | relative_url | uri_escape }}" alt="Duke logo">
              {% endif %}
            </span>
          {% endif %}
          
          <!-- 分隔线 -->
          <span class="brand-divider"></span>
          
          <!-- 网站标题 -->
          {% if site.logo-text != false %}
            <span class="title-text">
              {% if site.title and site.show-title != false %}
                <span class="title-line-1">CENTER</span>
                <span class="title-line-2">for COMPUTATIONAL</span>
                <span class="title-line-3">EVOLUTIONARY INTELLIGENCE</span>
              {% endif %}
            </span>
          {% endif %}
        </a>
      </div>
      
      <!-- 右侧：搜索框 -->
      <div class="search-section">
        <form class="search-form" action="{{ site.baseurl }}/search" method="get">
          <input 
            type="search" 
            class="search-input" 
            placeholder="Search..." 
            name="query"
            aria-label="Search"
          >
          <button type="submit" class="search-button" aria-label="Submit search">
            <i class="fas fa-search"></i>
          </button>
        </form>
      </div>
    </div>
  </div>
  
  <!-- Tier 2: 主导航栏 -->
  <div class="header-tier-2">
    <div class="header-container">
      <!-- 移动端导航切换按钮 -->
      <input class="nav-toggle" type="checkbox" id="nav-toggle" aria-label="show/hide nav">
      <label for="nav-toggle" class="nav-toggle-label">
        <span></span>
      </label>
      
      <!-- 主导航 -->
      <nav class="main-nav">
        {% assign pages = site.pages
          | where_exp: "page", "page.nav"
          | sort: "nav.order"
        %}
        {% for page in pages %}
          {% if page.nav %}
            <div class="nav-item{% if page.nav.dropdown %} has-dropdown{% endif %}">
              <a
                href="{{ page.dir | relative_url | uri_escape }}"
                data-tooltip="{{ page.nav.tooltip | xml_escape }}"
                class="nav-link"
              >
                {{ page.title }}
                {% if page.nav.dropdown %}
                  <i class="fas fa-chevron-down dropdown-icon"></i>
                {% endif %}
              </a>
              
              <!-- 下拉菜单（如果有的话） -->
              {% if page.nav.dropdown %}
                <div class="dropdown-menu">
                  {% for item in page.nav.dropdown %}
                    <a href="{{ item.url | relative_url | uri_escape }}" class="dropdown-link">
                      {{ item.title }}
                    </a>
                  {% endfor %}
                </div>
              {% endif %}
            </div>
          {% endif %}
        {% endfor %}
      </nav>
    </div>
  </div>
</header>